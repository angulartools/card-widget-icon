import { Component, isDevMode, ChangeDetectionStrategy, input, inject, numberAttribute, computed, } from '@angular/core';
import { NgClass, NgStyle } from '@angular/common';
import { NGX_SKELETON_LOADER_CONFIG, } from './ngx-skeleton-loader-config.types';
import * as i0 from "@angular/core";
/**
 * The `NgxSkeletonLoaderComponent` is a standalone Angular component that provides a skeleton
 * loader UI element.
 * It can be used to display a loading state before the actual content is available.
 * The component can be configured with various options such as the number of elements, appearance,
 * animation, and theme.
 */
export class NgxSkeletonLoaderComponent {
    constructor() {
        /**
         * Injects the `NgxSkeletonLoaderConfig` configuration object, which is optional.
         * This configuration object provides various options for customizing the behavior
         * and appearance of the `NgxSkeletonLoaderComponent`.
         */
        this.#config = inject(NGX_SKELETON_LOADER_CONFIG, { optional: true });
        /**
         * The `count` property is an input that determines the number of skeleton loader elements
         * to display.
         * It is initialized with the value from the `NgxSkeletonLoaderConfig` object, or 1 if the config
         * is not provided.
         * The `transform: numberAttribute` option ensures that the input value is converted to a number.
         */
        this.count = input(this.#config?.count || 1, { transform: numberAttribute });
        /**
         * The `loadingText` property is an input that determines the text to display while the content
         * is loading.
         * It is initialized with the value from the `NgxSkeletonLoaderConfig` object, or 'Loading...'
         * if the config is not provided.
         */
        this.loadingText = input(this.#config?.loadingText || 'Loading...');
        /**
         * The `appearance` property is an input that determines the visual appearance of the skeleton
         * loader.
         * It is initialized with the value from the `NgxSkeletonLoaderConfig` object, or 'line' if the
         * config is not provided.
         * The available appearance options are defined in the `NgxSkeletonLoaderConfig['appearance']`
         * type.
         */
        this.appearance = input(this.#config?.appearance || 'line');
        /**
         * The `animation` property is an input that determines the type of animation to apply to the
         * skeleton loader.
         * It is initialized with the value from the `NgxSkeletonLoaderConfig` object, or 'progress' if
         * the config is not provided.
         * The available animation options are defined in the `NgxSkeletonLoaderConfig['animation']` type.
         */
        this.animation = input(this.#config?.animation || 'progress');
        /**
         * The `ariaLabel` property is an input that determines the ARIA label to be used for the skeleton
         * loader element. This is useful for providing accessibility information to screen readers.
         * It is initialized with the value from the `NgxSkeletonLoaderConfig` object, or 'loading' if the
         * config is not provided.
         */
        this.ariaLabel = input(this.#config?.ariaLabel || 'loading');
        /**
         * The `theme` property is an input that determines the theme configuration for the skeleton
         * loader.
         * It is initialized with the value from the `NgxSkeletonLoaderConfig` object, or `null` if the
         * config is not provided.
         * The theme configuration is defined by the `NgxSkeletonLoaderConfigTheme` type, which allows
         * customizing various aspects of the skeleton loader's appearance, such as colors, animation,
         * etc.
         */
        this.theme = input(this.#config?.theme || null);
        /**
         * The `items` property is a computed property that generates an array of indices based on the
         * `count` input.
         * If the `appearance` is set to 'custom-content', the `count` is forced to 1 to ensure that the
         * skeleton loader is displayed as a single DOM node, as required by the 'custom-content'
         * appearance.
         * This computed property is used to render the appropriate number of skeleton loader elements.
         */
        this.items = computed(() => {
            let count = this.count() || 1;
            // Force count to 1 when custom-content is used
            if (this.appearance() === 'custom-content') {
                // Shows error message only in Development
                if (isDevMode() && count !== 1) {
                    console.error(`\`NgxSkeletonLoaderComponent\` enforces elements with "custom-content" appearance as DOM nodes. Forcing "count" to "1".`);
                    count = 1;
                }
            }
            return [...Array(count)].map((_, index) => index);
        });
        /**
         * A computed property that returns the final theme configuration for the skeleton loader.
         * If the `extendsFromRoot` property is set in the `NgxSkeletonLoaderConfig`, the theme is merged
         * with the root theme configuration. Otherwise, the theme is returned as-is.
         * This allows the skeleton loader to inherit global theme settings while still allowing for
         * component-specific theme customization.
         */
        this.styles = computed(() => {
            const theme = this.theme();
            if (this.#config?.theme?.extendsFromRoot) {
                return {
                    ...this.#config?.theme,
                    ...theme,
                };
            }
            return theme;
        });
    }
    /**
     * Injects the `NgxSkeletonLoaderConfig` configuration object, which is optional.
     * This configuration object provides various options for customizing the behavior
     * and appearance of the `NgxSkeletonLoaderComponent`.
     */
    #config;
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: NgxSkeletonLoaderComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: NgxSkeletonLoaderComponent, isStandalone: true, selector: "ngx-skeleton-loader", inputs: { count: { classPropertyName: "count", publicName: "count", isSignal: true, isRequired: false, transformFunction: null }, loadingText: { classPropertyName: "loadingText", publicName: "loadingText", isSignal: true, isRequired: false, transformFunction: null }, appearance: { classPropertyName: "appearance", publicName: "appearance", isSignal: true, isRequired: false, transformFunction: null }, animation: { classPropertyName: "animation", publicName: "animation", isSignal: true, isRequired: false, transformFunction: null }, ariaLabel: { classPropertyName: "ariaLabel", publicName: "ariaLabel", isSignal: true, isRequired: false, transformFunction: null }, theme: { classPropertyName: "theme", publicName: "theme", isSignal: true, isRequired: false, transformFunction: null } }, ngImport: i0, template: "@let appearanceValue = appearance();\n@let animationValue = animation();\n@for (item of items(); track item) {\n  <div\n    class=\"skeleton-loader\"\n    [attr.aria-label]=\"ariaLabel()\"\n    aria-busy=\"true\"\n    aria-valuemin=\"0\"\n    aria-valuemax=\"100\"\n    [attr.aria-valuetext]=\"loadingText()\"\n    role=\"progressbar\"\n    tabindex=\"-1\"\n    [ngClass]=\"{\n      'custom-content': appearanceValue === 'custom-content',\n      circle: appearanceValue === 'circle',\n      progress: animationValue === 'progress',\n      'progress-dark': animationValue === 'progress-dark',\n      pulse: animationValue === 'pulse'\n    }\"\n    [ngStyle]=\"styles()\"\n    >\n    @if (appearanceValue  === 'custom-content') {\n      <ng-content></ng-content>\n    }\n  </div>\n}\n", styles: [".skeleton-loader{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;border-radius:4px;width:100%;height:20px;display:inline-block;margin-bottom:10px;will-change:transform}.skeleton-loader:after,.skeleton-loader:before{box-sizing:border-box}.skeleton-loader.circle{width:40px;height:40px;margin:5px;border-radius:50%}.skeleton-loader.progress,.skeleton-loader.progress-dark{transform:translateZ(0)}.skeleton-loader.progress:after,.skeleton-loader.progress:before,.skeleton-loader.progress-dark:after,.skeleton-loader.progress-dark:before{box-sizing:border-box}.skeleton-loader.progress:before,.skeleton-loader.progress-dark:before{animation:progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:\"\"}.skeleton-loader.progress:before{background-image:linear-gradient(90deg,#fff0,#fff9,#fff0)}.skeleton-loader.progress-dark:before{background-image:linear-gradient(90deg,transparent,rgba(0,0,0,.2),transparent)}.skeleton-loader.pulse{animation:pulse 1.5s cubic-bezier(.4,0,.2,1) infinite;animation-delay:.5s}.skeleton-loader.custom-content{height:100%;background:none}@media (prefers-reduced-motion: reduce){.skeleton-loader.pulse,.skeleton-loader.progress-dark,.skeleton-loader.custom-content,.skeleton-loader.progress:before{animation:none}.skeleton-loader.progress:before,.skeleton-loader.progress-dark,.skeleton-loader.custom-content{background-image:none}}@media screen and (min-device-width: 1200px){.skeleton-loader{-webkit-user-select:none;user-select:none;cursor:wait}}@keyframes progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}@keyframes pulse{0%{opacity:1}50%{opacity:.4}to{opacity:1}}\n"], dependencies: [{ kind: "directive", type: NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: NgxSkeletonLoaderComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ngx-skeleton-loader', imports: [NgClass, NgStyle], changeDetection: ChangeDetectionStrategy.OnPush, standalone: true, template: "@let appearanceValue = appearance();\n@let animationValue = animation();\n@for (item of items(); track item) {\n  <div\n    class=\"skeleton-loader\"\n    [attr.aria-label]=\"ariaLabel()\"\n    aria-busy=\"true\"\n    aria-valuemin=\"0\"\n    aria-valuemax=\"100\"\n    [attr.aria-valuetext]=\"loadingText()\"\n    role=\"progressbar\"\n    tabindex=\"-1\"\n    [ngClass]=\"{\n      'custom-content': appearanceValue === 'custom-content',\n      circle: appearanceValue === 'circle',\n      progress: animationValue === 'progress',\n      'progress-dark': animationValue === 'progress-dark',\n      pulse: animationValue === 'pulse'\n    }\"\n    [ngStyle]=\"styles()\"\n    >\n    @if (appearanceValue  === 'custom-content') {\n      <ng-content></ng-content>\n    }\n  </div>\n}\n", styles: [".skeleton-loader{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;border-radius:4px;width:100%;height:20px;display:inline-block;margin-bottom:10px;will-change:transform}.skeleton-loader:after,.skeleton-loader:before{box-sizing:border-box}.skeleton-loader.circle{width:40px;height:40px;margin:5px;border-radius:50%}.skeleton-loader.progress,.skeleton-loader.progress-dark{transform:translateZ(0)}.skeleton-loader.progress:after,.skeleton-loader.progress:before,.skeleton-loader.progress-dark:after,.skeleton-loader.progress-dark:before{box-sizing:border-box}.skeleton-loader.progress:before,.skeleton-loader.progress-dark:before{animation:progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:\"\"}.skeleton-loader.progress:before{background-image:linear-gradient(90deg,#fff0,#fff9,#fff0)}.skeleton-loader.progress-dark:before{background-image:linear-gradient(90deg,transparent,rgba(0,0,0,.2),transparent)}.skeleton-loader.pulse{animation:pulse 1.5s cubic-bezier(.4,0,.2,1) infinite;animation-delay:.5s}.skeleton-loader.custom-content{height:100%;background:none}@media (prefers-reduced-motion: reduce){.skeleton-loader.pulse,.skeleton-loader.progress-dark,.skeleton-loader.custom-content,.skeleton-loader.progress:before{animation:none}.skeleton-loader.progress:before,.skeleton-loader.progress-dark,.skeleton-loader.custom-content{background-image:none}}@media screen and (min-device-width: 1200px){.skeleton-loader{-webkit-user-select:none;user-select:none;cursor:wait}}@keyframes progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}@keyframes pulse{0%{opacity:1}50%{opacity:.4}to{opacity:1}}\n"] }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNrZWxldG9uLWxvYWRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtc2tlbGV0b24tbG9hZGVyL3NyYy9saWIvbmd4LXNrZWxldG9uLWxvYWRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtc2tlbGV0b24tbG9hZGVyL3NyYy9saWIvbmd4LXNrZWxldG9uLWxvYWRlci5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUNULHVCQUF1QixFQUN2QixLQUFLLEVBQ0wsTUFBTSxFQUNOLGVBQWUsRUFDZixRQUFRLEdBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNuRCxPQUFPLEVBR0wsMEJBQTBCLEdBQzNCLE1BQU0sb0NBQW9DLENBQUM7O0FBRTVDOzs7Ozs7R0FNRztBQVNILE1BQU0sT0FBTywwQkFBMEI7SUFSdkM7UUFTRTs7OztXQUlHO1FBQ00sWUFBTyxHQUFHLE1BQU0sQ0FBMEIsMEJBQTBCLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUNsRzs7Ozs7O1dBTUc7UUFDTSxVQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDO1FBQ2pGOzs7OztXQUtHO1FBQ00sZ0JBQVcsR0FBRyxLQUFLLENBQXlDLElBQUksQ0FBQyxPQUFPLEVBQUUsV0FBVyxJQUFJLFlBQVksQ0FBQyxDQUFDO1FBQ2hIOzs7Ozs7O1dBT0c7UUFDTSxlQUFVLEdBQUcsS0FBSyxDQUF3QyxJQUFJLENBQUMsT0FBTyxFQUFFLFVBQVUsSUFBSSxNQUFNLENBQUMsQ0FBQztRQUN2Rzs7Ozs7O1dBTUc7UUFDTSxjQUFTLEdBQUcsS0FBSyxDQUF1QyxJQUFJLENBQUMsT0FBTyxFQUFFLFNBQVMsSUFBSSxVQUFVLENBQUMsQ0FBQztRQUN4Rzs7Ozs7V0FLRztRQUNNLGNBQVMsR0FBRyxLQUFLLENBQXVDLElBQUksQ0FBQyxPQUFPLEVBQUUsU0FBUyxJQUFJLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZHOzs7Ozs7OztXQVFHO1FBQ00sVUFBSyxHQUFHLEtBQUssQ0FBK0IsSUFBSSxDQUFDLE9BQU8sRUFBRSxLQUFLLElBQUksSUFBSSxDQUFDLENBQUM7UUFDbEY7Ozs7Ozs7V0FPRztRQUNNLFVBQUssR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFO1lBQzdCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDOUIsK0NBQStDO1lBQy9DLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxLQUFLLGdCQUFnQixFQUFFLENBQUM7Z0JBQzNDLDBDQUEwQztnQkFDMUMsSUFBSSxTQUFTLEVBQUUsSUFBSSxLQUFLLEtBQUssQ0FBQyxFQUFFLENBQUM7b0JBQy9CLE9BQU8sQ0FBQyxLQUFLLENBQ1gseUhBQXlILENBQzFILENBQUM7b0JBQ0YsS0FBSyxHQUFHLENBQUMsQ0FBQztnQkFDWixDQUFDO1lBQ0gsQ0FBQztZQUNELE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BELENBQUMsQ0FBQyxDQUFDO1FBQ0g7Ozs7OztXQU1HO1FBQ00sV0FBTSxHQUFHLFFBQVEsQ0FBQyxHQUFHLEVBQUU7WUFDOUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQzNCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLENBQUM7Z0JBQ3pDLE9BQU87b0JBQ0wsR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUs7b0JBQ3RCLEdBQUcsS0FBSztpQkFDVCxDQUFDO1lBQ0osQ0FBQztZQUNELE9BQU8sS0FBSyxDQUFDO1FBQ2YsQ0FBQyxDQUFDLENBQUM7S0FDSjtJQTlGQzs7OztPQUlHO0lBQ00sT0FBTyxDQUFrRjsrR0FOdkYsMEJBQTBCO21HQUExQiwwQkFBMEIsbzJCQy9CdkMsZ3hCQTBCQSxzeEREQ1ksT0FBTyxvRkFBRSxPQUFPOzs0RkFJZiwwQkFBMEI7a0JBUnRDLFNBQVM7K0JBQ0UscUJBQXFCLFdBR3RCLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxtQkFDVix1QkFBdUIsQ0FBQyxNQUFNLGNBQ25DLElBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIGlzRGV2TW9kZSxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIGlucHV0LFxuICBpbmplY3QsXG4gIG51bWJlckF0dHJpYnV0ZSxcbiAgY29tcHV0ZWQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmdDbGFzcywgTmdTdHlsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuICBOZ3hTa2VsZXRvbkxvYWRlckNvbmZpZyxcbiAgTmd4U2tlbGV0b25Mb2FkZXJDb25maWdUaGVtZSxcbiAgTkdYX1NLRUxFVE9OX0xPQURFUl9DT05GSUcsXG59IGZyb20gJy4vbmd4LXNrZWxldG9uLWxvYWRlci1jb25maWcudHlwZXMnO1xuXG4vKipcbiAqIFRoZSBgTmd4U2tlbGV0b25Mb2FkZXJDb21wb25lbnRgIGlzIGEgc3RhbmRhbG9uZSBBbmd1bGFyIGNvbXBvbmVudCB0aGF0IHByb3ZpZGVzIGEgc2tlbGV0b25cbiAqIGxvYWRlciBVSSBlbGVtZW50LlxuICogSXQgY2FuIGJlIHVzZWQgdG8gZGlzcGxheSBhIGxvYWRpbmcgc3RhdGUgYmVmb3JlIHRoZSBhY3R1YWwgY29udGVudCBpcyBhdmFpbGFibGUuXG4gKiBUaGUgY29tcG9uZW50IGNhbiBiZSBjb25maWd1cmVkIHdpdGggdmFyaW91cyBvcHRpb25zIHN1Y2ggYXMgdGhlIG51bWJlciBvZiBlbGVtZW50cywgYXBwZWFyYW5jZSxcbiAqIGFuaW1hdGlvbiwgYW5kIHRoZW1lLlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtc2tlbGV0b24tbG9hZGVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL25neC1za2VsZXRvbi1sb2FkZXIuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL25neC1za2VsZXRvbi1sb2FkZXIuc2NzcyddLFxuICBpbXBvcnRzOiBbTmdDbGFzcywgTmdTdHlsZV0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzdGFuZGFsb25lOiB0cnVlLFxufSlcbmV4cG9ydCBjbGFzcyBOZ3hTa2VsZXRvbkxvYWRlckNvbXBvbmVudCB7XG4gIC8qKlxuICAgKiBJbmplY3RzIHRoZSBgTmd4U2tlbGV0b25Mb2FkZXJDb25maWdgIGNvbmZpZ3VyYXRpb24gb2JqZWN0LCB3aGljaCBpcyBvcHRpb25hbC5cbiAgICogVGhpcyBjb25maWd1cmF0aW9uIG9iamVjdCBwcm92aWRlcyB2YXJpb3VzIG9wdGlvbnMgZm9yIGN1c3RvbWl6aW5nIHRoZSBiZWhhdmlvclxuICAgKiBhbmQgYXBwZWFyYW5jZSBvZiB0aGUgYE5neFNrZWxldG9uTG9hZGVyQ29tcG9uZW50YC5cbiAgICovXG4gIHJlYWRvbmx5ICNjb25maWcgPSBpbmplY3Q8Tmd4U2tlbGV0b25Mb2FkZXJDb25maWc+KE5HWF9TS0VMRVRPTl9MT0FERVJfQ09ORklHLCB7IG9wdGlvbmFsOiB0cnVlfSk7XG4gIC8qKlxuICAgKiBUaGUgYGNvdW50YCBwcm9wZXJ0eSBpcyBhbiBpbnB1dCB0aGF0IGRldGVybWluZXMgdGhlIG51bWJlciBvZiBza2VsZXRvbiBsb2FkZXIgZWxlbWVudHNcbiAgICogdG8gZGlzcGxheS5cbiAgICogSXQgaXMgaW5pdGlhbGl6ZWQgd2l0aCB0aGUgdmFsdWUgZnJvbSB0aGUgYE5neFNrZWxldG9uTG9hZGVyQ29uZmlnYCBvYmplY3QsIG9yIDEgaWYgdGhlIGNvbmZpZ1xuICAgKiBpcyBub3QgcHJvdmlkZWQuXG4gICAqIFRoZSBgdHJhbnNmb3JtOiBudW1iZXJBdHRyaWJ1dGVgIG9wdGlvbiBlbnN1cmVzIHRoYXQgdGhlIGlucHV0IHZhbHVlIGlzIGNvbnZlcnRlZCB0byBhIG51bWJlci5cbiAgICovXG4gIHJlYWRvbmx5IGNvdW50ID0gaW5wdXQodGhpcy4jY29uZmlnPy5jb3VudCB8fCAxLCB7IHRyYW5zZm9ybTogbnVtYmVyQXR0cmlidXRlIH0pO1xuICAvKipcbiAgICogVGhlIGBsb2FkaW5nVGV4dGAgcHJvcGVydHkgaXMgYW4gaW5wdXQgdGhhdCBkZXRlcm1pbmVzIHRoZSB0ZXh0IHRvIGRpc3BsYXkgd2hpbGUgdGhlIGNvbnRlbnRcbiAgICogaXMgbG9hZGluZy5cbiAgICogSXQgaXMgaW5pdGlhbGl6ZWQgd2l0aCB0aGUgdmFsdWUgZnJvbSB0aGUgYE5neFNrZWxldG9uTG9hZGVyQ29uZmlnYCBvYmplY3QsIG9yICdMb2FkaW5nLi4uJ1xuICAgKiBpZiB0aGUgY29uZmlnIGlzIG5vdCBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGxvYWRpbmdUZXh0ID0gaW5wdXQ8Tmd4U2tlbGV0b25Mb2FkZXJDb25maWdbJ2xvYWRpbmdUZXh0J10+KHRoaXMuI2NvbmZpZz8ubG9hZGluZ1RleHQgfHwgJ0xvYWRpbmcuLi4nKTtcbiAgLyoqXG4gICAqIFRoZSBgYXBwZWFyYW5jZWAgcHJvcGVydHkgaXMgYW4gaW5wdXQgdGhhdCBkZXRlcm1pbmVzIHRoZSB2aXN1YWwgYXBwZWFyYW5jZSBvZiB0aGUgc2tlbGV0b25cbiAgICogbG9hZGVyLlxuICAgKiBJdCBpcyBpbml0aWFsaXplZCB3aXRoIHRoZSB2YWx1ZSBmcm9tIHRoZSBgTmd4U2tlbGV0b25Mb2FkZXJDb25maWdgIG9iamVjdCwgb3IgJ2xpbmUnIGlmIHRoZVxuICAgKiBjb25maWcgaXMgbm90IHByb3ZpZGVkLlxuICAgKiBUaGUgYXZhaWxhYmxlIGFwcGVhcmFuY2Ugb3B0aW9ucyBhcmUgZGVmaW5lZCBpbiB0aGUgYE5neFNrZWxldG9uTG9hZGVyQ29uZmlnWydhcHBlYXJhbmNlJ11gXG4gICAqIHR5cGUuXG4gICAqL1xuICByZWFkb25seSBhcHBlYXJhbmNlID0gaW5wdXQ8Tmd4U2tlbGV0b25Mb2FkZXJDb25maWdbJ2FwcGVhcmFuY2UnXT4odGhpcy4jY29uZmlnPy5hcHBlYXJhbmNlIHx8ICdsaW5lJyk7XG4gIC8qKlxuICAgKiBUaGUgYGFuaW1hdGlvbmAgcHJvcGVydHkgaXMgYW4gaW5wdXQgdGhhdCBkZXRlcm1pbmVzIHRoZSB0eXBlIG9mIGFuaW1hdGlvbiB0byBhcHBseSB0byB0aGVcbiAgICogc2tlbGV0b24gbG9hZGVyLlxuICAgKiBJdCBpcyBpbml0aWFsaXplZCB3aXRoIHRoZSB2YWx1ZSBmcm9tIHRoZSBgTmd4U2tlbGV0b25Mb2FkZXJDb25maWdgIG9iamVjdCwgb3IgJ3Byb2dyZXNzJyBpZlxuICAgKiB0aGUgY29uZmlnIGlzIG5vdCBwcm92aWRlZC5cbiAgICogVGhlIGF2YWlsYWJsZSBhbmltYXRpb24gb3B0aW9ucyBhcmUgZGVmaW5lZCBpbiB0aGUgYE5neFNrZWxldG9uTG9hZGVyQ29uZmlnWydhbmltYXRpb24nXWAgdHlwZS5cbiAgICovXG4gIHJlYWRvbmx5IGFuaW1hdGlvbiA9IGlucHV0PE5neFNrZWxldG9uTG9hZGVyQ29uZmlnWydhbmltYXRpb24nXT4odGhpcy4jY29uZmlnPy5hbmltYXRpb24gfHwgJ3Byb2dyZXNzJyk7XG4gIC8qKlxuICAgKiBUaGUgYGFyaWFMYWJlbGAgcHJvcGVydHkgaXMgYW4gaW5wdXQgdGhhdCBkZXRlcm1pbmVzIHRoZSBBUklBIGxhYmVsIHRvIGJlIHVzZWQgZm9yIHRoZSBza2VsZXRvblxuICAgKiBsb2FkZXIgZWxlbWVudC4gVGhpcyBpcyB1c2VmdWwgZm9yIHByb3ZpZGluZyBhY2Nlc3NpYmlsaXR5IGluZm9ybWF0aW9uIHRvIHNjcmVlbiByZWFkZXJzLlxuICAgKiBJdCBpcyBpbml0aWFsaXplZCB3aXRoIHRoZSB2YWx1ZSBmcm9tIHRoZSBgTmd4U2tlbGV0b25Mb2FkZXJDb25maWdgIG9iamVjdCwgb3IgJ2xvYWRpbmcnIGlmIHRoZVxuICAgKiBjb25maWcgaXMgbm90IHByb3ZpZGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgYXJpYUxhYmVsID0gaW5wdXQ8Tmd4U2tlbGV0b25Mb2FkZXJDb25maWdbJ2FyaWFMYWJlbCddPih0aGlzLiNjb25maWc/LmFyaWFMYWJlbCB8fCAnbG9hZGluZycpO1xuICAvKipcbiAgICogVGhlIGB0aGVtZWAgcHJvcGVydHkgaXMgYW4gaW5wdXQgdGhhdCBkZXRlcm1pbmVzIHRoZSB0aGVtZSBjb25maWd1cmF0aW9uIGZvciB0aGUgc2tlbGV0b25cbiAgICogbG9hZGVyLlxuICAgKiBJdCBpcyBpbml0aWFsaXplZCB3aXRoIHRoZSB2YWx1ZSBmcm9tIHRoZSBgTmd4U2tlbGV0b25Mb2FkZXJDb25maWdgIG9iamVjdCwgb3IgYG51bGxgIGlmIHRoZVxuICAgKiBjb25maWcgaXMgbm90IHByb3ZpZGVkLlxuICAgKiBUaGUgdGhlbWUgY29uZmlndXJhdGlvbiBpcyBkZWZpbmVkIGJ5IHRoZSBgTmd4U2tlbGV0b25Mb2FkZXJDb25maWdUaGVtZWAgdHlwZSwgd2hpY2ggYWxsb3dzXG4gICAqIGN1c3RvbWl6aW5nIHZhcmlvdXMgYXNwZWN0cyBvZiB0aGUgc2tlbGV0b24gbG9hZGVyJ3MgYXBwZWFyYW5jZSwgc3VjaCBhcyBjb2xvcnMsIGFuaW1hdGlvbixcbiAgICogZXRjLlxuICAgKi9cbiAgcmVhZG9ubHkgdGhlbWUgPSBpbnB1dDxOZ3hTa2VsZXRvbkxvYWRlckNvbmZpZ1RoZW1lPih0aGlzLiNjb25maWc/LnRoZW1lIHx8IG51bGwpO1xuICAvKipcbiAgICogVGhlIGBpdGVtc2AgcHJvcGVydHkgaXMgYSBjb21wdXRlZCBwcm9wZXJ0eSB0aGF0IGdlbmVyYXRlcyBhbiBhcnJheSBvZiBpbmRpY2VzIGJhc2VkIG9uIHRoZVxuICAgKiBgY291bnRgIGlucHV0LlxuICAgKiBJZiB0aGUgYGFwcGVhcmFuY2VgIGlzIHNldCB0byAnY3VzdG9tLWNvbnRlbnQnLCB0aGUgYGNvdW50YCBpcyBmb3JjZWQgdG8gMSB0byBlbnN1cmUgdGhhdCB0aGVcbiAgICogc2tlbGV0b24gbG9hZGVyIGlzIGRpc3BsYXllZCBhcyBhIHNpbmdsZSBET00gbm9kZSwgYXMgcmVxdWlyZWQgYnkgdGhlICdjdXN0b20tY29udGVudCdcbiAgICogYXBwZWFyYW5jZS5cbiAgICogVGhpcyBjb21wdXRlZCBwcm9wZXJ0eSBpcyB1c2VkIHRvIHJlbmRlciB0aGUgYXBwcm9wcmlhdGUgbnVtYmVyIG9mIHNrZWxldG9uIGxvYWRlciBlbGVtZW50cy5cbiAgICovXG4gIHJlYWRvbmx5IGl0ZW1zID0gY29tcHV0ZWQoKCkgPT4ge1xuICAgIGxldCBjb3VudCA9IHRoaXMuY291bnQoKSB8fCAxO1xuICAgIC8vIEZvcmNlIGNvdW50IHRvIDEgd2hlbiBjdXN0b20tY29udGVudCBpcyB1c2VkXG4gICAgaWYgKHRoaXMuYXBwZWFyYW5jZSgpID09PSAnY3VzdG9tLWNvbnRlbnQnKSB7XG4gICAgICAvLyBTaG93cyBlcnJvciBtZXNzYWdlIG9ubHkgaW4gRGV2ZWxvcG1lbnRcbiAgICAgIGlmIChpc0Rldk1vZGUoKSAmJiBjb3VudCAhPT0gMSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgIGBcXGBOZ3hTa2VsZXRvbkxvYWRlckNvbXBvbmVudFxcYCBlbmZvcmNlcyBlbGVtZW50cyB3aXRoIFwiY3VzdG9tLWNvbnRlbnRcIiBhcHBlYXJhbmNlIGFzIERPTSBub2Rlcy4gRm9yY2luZyBcImNvdW50XCIgdG8gXCIxXCIuYCxcbiAgICAgICAgKTtcbiAgICAgICAgY291bnQgPSAxO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gWy4uLkFycmF5KGNvdW50KV0ubWFwKChfLCBpbmRleCkgPT4gaW5kZXgpO1xuICB9KTtcbiAgLyoqXG4gICAqIEEgY29tcHV0ZWQgcHJvcGVydHkgdGhhdCByZXR1cm5zIHRoZSBmaW5hbCB0aGVtZSBjb25maWd1cmF0aW9uIGZvciB0aGUgc2tlbGV0b24gbG9hZGVyLlxuICAgKiBJZiB0aGUgYGV4dGVuZHNGcm9tUm9vdGAgcHJvcGVydHkgaXMgc2V0IGluIHRoZSBgTmd4U2tlbGV0b25Mb2FkZXJDb25maWdgLCB0aGUgdGhlbWUgaXMgbWVyZ2VkXG4gICAqIHdpdGggdGhlIHJvb3QgdGhlbWUgY29uZmlndXJhdGlvbi4gT3RoZXJ3aXNlLCB0aGUgdGhlbWUgaXMgcmV0dXJuZWQgYXMtaXMuXG4gICAqIFRoaXMgYWxsb3dzIHRoZSBza2VsZXRvbiBsb2FkZXIgdG8gaW5oZXJpdCBnbG9iYWwgdGhlbWUgc2V0dGluZ3Mgd2hpbGUgc3RpbGwgYWxsb3dpbmcgZm9yXG4gICAqIGNvbXBvbmVudC1zcGVjaWZpYyB0aGVtZSBjdXN0b21pemF0aW9uLlxuICAgKi9cbiAgcmVhZG9ubHkgc3R5bGVzID0gY29tcHV0ZWQoKCkgPT4ge1xuICAgIGNvbnN0IHRoZW1lID0gdGhpcy50aGVtZSgpO1xuICAgIGlmICh0aGlzLiNjb25maWc/LnRoZW1lPy5leHRlbmRzRnJvbVJvb3QpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRoaXMuI2NvbmZpZz8udGhlbWUsXG4gICAgICAgIC4uLnRoZW1lLFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHRoZW1lO1xuICB9KTtcbn1cbiIsIkBsZXQgYXBwZWFyYW5jZVZhbHVlID0gYXBwZWFyYW5jZSgpO1xuQGxldCBhbmltYXRpb25WYWx1ZSA9IGFuaW1hdGlvbigpO1xuQGZvciAoaXRlbSBvZiBpdGVtcygpOyB0cmFjayBpdGVtKSB7XG4gIDxkaXZcbiAgICBjbGFzcz1cInNrZWxldG9uLWxvYWRlclwiXG4gICAgW2F0dHIuYXJpYS1sYWJlbF09XCJhcmlhTGFiZWwoKVwiXG4gICAgYXJpYS1idXN5PVwidHJ1ZVwiXG4gICAgYXJpYS12YWx1ZW1pbj1cIjBcIlxuICAgIGFyaWEtdmFsdWVtYXg9XCIxMDBcIlxuICAgIFthdHRyLmFyaWEtdmFsdWV0ZXh0XT1cImxvYWRpbmdUZXh0KClcIlxuICAgIHJvbGU9XCJwcm9ncmVzc2JhclwiXG4gICAgdGFiaW5kZXg9XCItMVwiXG4gICAgW25nQ2xhc3NdPVwie1xuICAgICAgJ2N1c3RvbS1jb250ZW50JzogYXBwZWFyYW5jZVZhbHVlID09PSAnY3VzdG9tLWNvbnRlbnQnLFxuICAgICAgY2lyY2xlOiBhcHBlYXJhbmNlVmFsdWUgPT09ICdjaXJjbGUnLFxuICAgICAgcHJvZ3Jlc3M6IGFuaW1hdGlvblZhbHVlID09PSAncHJvZ3Jlc3MnLFxuICAgICAgJ3Byb2dyZXNzLWRhcmsnOiBhbmltYXRpb25WYWx1ZSA9PT0gJ3Byb2dyZXNzLWRhcmsnLFxuICAgICAgcHVsc2U6IGFuaW1hdGlvblZhbHVlID09PSAncHVsc2UnXG4gICAgfVwiXG4gICAgW25nU3R5bGVdPVwic3R5bGVzKClcIlxuICAgID5cbiAgICBAaWYgKGFwcGVhcmFuY2VWYWx1ZSAgPT09ICdjdXN0b20tY29udGVudCcpIHtcbiAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICB9XG4gIDwvZGl2PlxufVxuIl19